{"version":3,"sources":["webpack://fryan.goauth/./src/lib/index.ts","webpack://fryan.goauth/webpack/bootstrap","webpack://fryan.goauth/./src/main.js"],"names":["FryanGoauth","config","gapi","undefined","then","fn","success","this","catch","error","afterGapiMounted","afterGapiClientMounted","oAuthSignedIn","oAuthSignedOut","afterOAuthSigned","auth","_this","signed","auth2","getAuthInstance","isSignedIn","get","ers","console","log","signin","Promise","reject","r","signIn","resolve","signout","signOut","profile","currentUser","getBasicProfile","id","getId","name","getName","giveName","getGivenName","familyName","getFamilyName","image","getImageUrl","email","getEmail","bind","location","protocol","href","window","substring","length","url","script","document","createElement","type","onload","e","onerror","src","getElementsByTagName","appendChild","sResolve","sReject","load","client","goAuthResolve","goAuthReject","gClient","GOAUTH_CONFIG","init","apiKey","clientId","clientID","scope","scopes","join","discoveryDocs","checkSignInOut","getProfile","gmail","guid","listen","signInStatus","gapiPath","oAuthConfig","err","gapiClient","opt","signedIn","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","call","require"],"mappings":"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","file":"fryan.goauth.min.js","sourcesContent":["interface Window { gapi: object }\ninterface FryanGoAuthInterface {\n\n}\n\ninterface configOauthI {\n  apiKey: String,\n  clientID: String,\n  discoveryDocs: Array<String>\n  scopes: Array<String>\n}\n\ninterface configI {\n  gapiPath: String,\n  oAuthConfig: configOauthI,\n  lifeCycle: {\n  }\n}\n\nclass FryanGoauth implements FryanGoAuthInterface{\n  static '#GAPI': string\n  static '#AUTH_OPTIONS': configOauthI\n  static '#LIFECYCLE' = {\n    afterGapiMounted: (gapi?: object) => {},\n    afterGapiClientMounted: (gapiClient?: object) => {},\n    oAuthSignedIn: (opt: { guid: string, gmail: string }) => {},\n    oAuthSignedOut: () => {},\n    afterOAuthSigned: (signedIn: boolean) => {},\n    success: () => {},\n    error: (err: string) => {}\n  }\n\n  static '#GOAUTH_CONFIG' : configOauthI = {\n    apiKey: ``,\n    clientID: ``,\n    discoveryDocs: [],\n    scopes: []\n  }\n\n  gapi: any = undefined\n\n  constructor (config: configI) {\n    FryanGoauth['#GAPI'] = `${config.gapiPath}`\n    FryanGoauth['#GOAUTH_CONFIG'].apiKey = config.oAuthConfig.apiKey\n    FryanGoauth['#GOAUTH_CONFIG'].clientID = config.oAuthConfig.clientID\n    FryanGoauth['#GOAUTH_CONFIG'].discoveryDocs = config.oAuthConfig.discoveryDocs\n    FryanGoauth['#GOAUTH_CONFIG'].scopes = config.oAuthConfig.scopes\n    this.#init()\n      .then(() => {\n        FryanGoauth['#LIFECYCLE'].success()\n      })\n      .catch((err) => {\n        FryanGoauth['#LIFECYCLE'].error(err)\n      })\n  }\n\n  // HOOKS\n  then = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].success = fn\n    return this\n  }\n\n  catch = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].error = fn\n    return this\n  }\n\n  afterGapiMounted = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterGapiMounted = fn\n    return this\n  }\n\n  afterGapiClientMounted = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterGapiClientMounted = fn\n    return this\n  }\n\n  oAuthSignedIn = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].oAuthSignedIn = fn\n    return this\n  }\n  oAuthSignedOut = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].oAuthSignedOut = fn\n    return this\n  }\n  afterOAuthSigned = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterOAuthSigned = fn\n    return this\n  }\n\n  // methods\n  auth = (function () {\n    const _this = this\n\n    return {\n      get isSignedIn () {\n        const gapi = _this.gapi\n        let signed = false\n        try {\n          signed = gapi.auth2.getAuthInstance().isSignedIn.get()\n        } catch (ers) {\n          console.log('[isSignedIn] - Unready init')\n        }\n        return signed\n      },\n      signin: function () : Promise<any> {\n        const gapi = _this.gapi\n\n        if (this.isSignedIn) {\n          return Promise.reject('Already signed in')\n        } else {\n          try {\n            let r = gapi.auth2.getAuthInstance().signIn()\n            return Promise.resolve(r)\n          } catch (ers) {\n            console.log('[signin] - Unready init', ers)\n            return Promise.reject()\n          }\n        }\n      },\n      signout: function () : Promise<any>{\n        const gapi = _this.gapi\n\n        if (!this.isSignedIn) {\n          return Promise.reject('Already signed out')\n        } else {\n          try {\n            let r = gapi.auth2.getAuthInstance().signOut()\n            return Promise.resolve(r)\n          } catch (ers) {\n            console.log('[signOut] - Unready init', ers)\n            return Promise.reject()\n          }\n        }\n      },\n      get getUserProfile () : Promise<any> {\n        const gapi = _this.gapi\n\n        if (!this.isSignedIn) {\n          return Promise.reject(false)\n        }\n        try {\n          const profile = gapi.auth2.getAuthInstance()\n            .currentUser.get().getBasicProfile()\n          return Promise.resolve({\n            id: profile.getId(),\n            name: profile.getName(),\n            giveName: profile.getGivenName(),\n            familyName: profile.getFamilyName(),\n            image: profile.getImageUrl(),\n            email: profile.getEmail(),\n          })\n        } catch (ers) {\n          return Promise.reject('[getUserProfile] - Error when get user profile')\n        }\n      }\n    }\n  }).bind(this)()\n\n  // init\n  #init = function () {\n    return new Promise(async (resolve, reject) => {\n      const _this = this\n\n      const isHttps: boolean = await (async function () {\n        if (location.protocol !== 'https:') {\n          location.href = 'https:' + window.location.href.substring(window.location.protocol.length)\n          return false\n        }\n        return true\n      })()\n      if (!isHttps) { reject('Not https') }\n\n      const loadGapi: boolean = await ((url: string) => {\n        return new Promise((resolve, reject) => {\n          var script = document.createElement('script')\n          script.type = 'text/javascript'\n          try {\n            script.onload = function (e) {\n              if (window.gapi !== undefined) {\n                resolve(true)\n              } else {\n                reject(false)\n              }\n            };\n            script.onerror = () => { reject(false) }\n            script.src = url\n            document.getElementsByTagName(\"head\")[0].appendChild(script)\n          } catch (ers: any) {\n            reject(false)\n          }\n        })\n      })(FryanGoauth['#GAPI'])\n        .then(() => {\n          FryanGoauth['#LIFECYCLE'].afterGapiMounted(window.gapi)\n          this.gapi = window.gapi\n          return true\n        })\n        .catch(() => { return false })\n      if (!loadGapi) { reject('Gapi is not loaded') }\n\n      const loadGapiClient: any = await (async function () {\n        const gapi = _this.gapi\n        return await new Promise((sResolve, sReject) => {\n          gapi.load('client', function () {\n            if (\n              gapi &&\n              gapi.client\n            ) {\n              sResolve(true)\n            } else {\n              sReject(false)\n            }\n          })\n        })\n          .then(() => {\n            FryanGoauth['#LIFECYCLE'].afterGapiClientMounted(_this.gapi.client)\n            return true\n          })\n          .catch(() => { return false })\n      })()\n      if (!loadGapiClient) { reject('Error when loading client from gapi ') }\n\n      const loadGoAuth: any = await (async () => {\n        return await new Promise((goAuthResolve, goAuthReject) => {\n          const gClient = this.gapi.client\n          const GOAUTH_CONFIG = FryanGoauth['#GOAUTH_CONFIG']\n\n          gClient.init({\n            apiKey: GOAUTH_CONFIG.apiKey,\n            clientId: GOAUTH_CONFIG.clientID,\n            scope: GOAUTH_CONFIG.scopes.join(' '),\n            discoveryDocs: GOAUTH_CONFIG.discoveryDocs\n          })\n            .then(function () {\n              const auth2 = _this.gapi.auth2\n\n              const checkSignInOut = function (isSignedIn: boolean) {\n                if (isSignedIn) {\n                  // signin\n                  const profile = auth2.getAuthInstance().currentUser.get()\n                  const getProfile = profile.getBasicProfile()\n                  const gmail = getProfile.getEmail()\n                  const guid = getProfile.getId()\n                  FryanGoauth['#LIFECYCLE'].oAuthSignedIn({\n                    guid, gmail\n                  })\n                } else {\n                  // signout\n                  FryanGoauth['#LIFECYCLE'].oAuthSignedOut()\n                }\n                FryanGoauth['#LIFECYCLE'].afterOAuthSigned(isSignedIn)\n              }\n\n              // listen Signin\n              auth2.getAuthInstance().isSignedIn.listen(\n                function (isSignedIn: boolean) {\n                  checkSignInOut(isSignedIn)\n                }\n              )\n\n              Promise.resolve(\n                auth2.getAuthInstance()\n              ).then(() => {\n                const signInStatus = auth2.getAuthInstance().isSignedIn.get()\n                checkSignInOut(signInStatus)\n                if (!signInStatus) {\n                  auth2.getAuthInstance().signIn()\n                }\n                goAuthResolve(true)\n              })\n            })\n            .catch((ers : any) => {\n              goAuthReject( `An error occurred when loading gapi.client.oAuth`)\n            })\n\n        })\n      })()\n      if (!loadGoAuth) { reject('Error when loading gapi.client.auth')}\n      resolve(true)\n\n    })\n  }\n}\n\nwindow.FryanGoauth = FryanGoauth","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","require('/@/lib')\n"],"sourceRoot":""}