{"version":3,"sources":["webpack://fryan.goauth/./src/lib/index.ts","webpack://fryan.goauth/./src/main.js"],"names":["config","gapi","undefined","then","fn","success","this","catch","error","afterGapiMounted","afterGapiClientMounted","oAuthSignedIn","oAuthSignedOut","afterOAuthSigned","auth","_this","signed","auth2","getAuthInstance","isSignedIn","get","ers","console","log","Promise","reject","r","signIn","resolve","signOut","profile","currentUser","getBasicProfile","id","getId","name","getName","giveName","getGivenName","familyName","getFamilyName","image","getImageUrl","email","getEmail","bind","window","location","protocol","href","substring","length","url","loadGapiResolve","loadGapiReject","script","document","createElement","type","onload","e","onerror","src","getElementsByTagName","appendChild","sResolve","sReject","load","client","goAuthResolve","goAuthReject","gClient","GOAUTH_CONFIG","init","apiKey","clientId","clientID","scope","scopes","join","discoveryDocs","checkSignInOut","getProfile","gmail","guid","listen","signInStatus","gapiPath","oAuthConfig","err","gapiClient","opt","signedIn","FryanGoauth"],"mappings":"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","file":"fryan.goauth.min.js","sourcesContent":["declare global {\n  // eslint-disable-next-line\n  interface Window {\n    gapi: any\n  }\n}\n\ninterface FryanGoAuthInterface {\n\n}\n\ninterface configOauthI {\n  apiKey: String,\n  clientID: String,\n  discoveryDocs: Array<String>\n  scopes: Array<String>\n}\n\ninterface configI {\n  gapiPath: String,\n  oAuthConfig: configOauthI,\n  lifeCycle: {\n  }\n}\n\nclass FryanGoauth implements FryanGoAuthInterface {\n  static '#GAPI': string\n\n  static '#AUTH_OPTIONS': configOauthI\n\n  static '#LIFECYCLE' = {\n    afterGapiMounted: (gapi?: object) => {},\n    afterGapiClientMounted: (gapiClient?: object) => {},\n    oAuthSignedIn: (opt: { guid: string, gmail: string }) => {},\n    oAuthSignedOut: () => {},\n    afterOAuthSigned: (signedIn: boolean) => {},\n    success: () => {},\n    error: (err: string) => {}\n  }\n\n  static '#GOAUTH_CONFIG' : configOauthI = {\n    apiKey: ``,\n    clientID: ``,\n    discoveryDocs: [],\n    scopes: []\n  }\n\n  gapi: any = undefined\n\n  constructor (config: configI) {\n    FryanGoauth['#GAPI'] = `${config.gapiPath}`\n    FryanGoauth['#GOAUTH_CONFIG'].apiKey = config.oAuthConfig.apiKey\n    FryanGoauth['#GOAUTH_CONFIG'].clientID = config.oAuthConfig.clientID\n    FryanGoauth['#GOAUTH_CONFIG'].discoveryDocs = config.oAuthConfig.discoveryDocs\n    FryanGoauth['#GOAUTH_CONFIG'].scopes = config.oAuthConfig.scopes\n    this.#init()\n      .then(() => {\n        FryanGoauth['#LIFECYCLE'].success()\n      })\n      .catch((err) => {\n        FryanGoauth['#LIFECYCLE'].error(err)\n      })\n  }\n\n  // HOOKS\n  then = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].success = fn\n    return this\n  }\n\n  catch = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].error = fn\n    return this\n  }\n\n  afterGapiMounted = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterGapiMounted = fn\n    return this\n  }\n\n  afterGapiClientMounted = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterGapiClientMounted = fn\n    return this\n  }\n\n  oAuthSignedIn = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].oAuthSignedIn = fn\n    return this\n  }\n\n  oAuthSignedOut = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].oAuthSignedOut = fn\n    return this\n  }\n\n  afterOAuthSigned = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterOAuthSigned = fn\n    return this\n  }\n\n  // methods\n  auth = (function () {\n    const _this = this\n\n    return {\n      get isSignedIn () {\n        const { gapi } = _this\n        let signed = false\n        try {\n          signed = gapi.auth2.getAuthInstance().isSignedIn.get()\n        } catch (ers) {\n          console.log('[isSignedIn] - Unready init') // eslint-disable-line\n        }\n        return signed\n      },\n      signin () : Promise<any> {\n        const { gapi } = _this\n\n        if (this.isSignedIn) {\n          return Promise.reject('Already signed in')\n        }\n        try {\n          const r = gapi.auth2.getAuthInstance().signIn()\n          return Promise.resolve(r)\n        } catch (ers) {\n          // console.log('[signin] - Unready init', ers)\n          return Promise.reject(ers)\n        }\n      },\n      signout () : Promise<any> {\n        const { gapi } = _this\n\n        if (!this.isSignedIn) {\n          return Promise.reject('Already signed out')\n        }\n        try {\n          const r = gapi.auth2.getAuthInstance().signOut()\n          return Promise.resolve(r)\n        } catch (ers) {\n          // console.log('[signOut] - Unready init', ers)\n          return Promise.reject(ers)\n        }\n      },\n      get getUserProfile () : Promise<any> {\n        const { gapi } = _this\n\n        if (!this.isSignedIn) {\n          return Promise.reject(false)\n        }\n        try {\n          const profile = gapi.auth2.getAuthInstance()\n            .currentUser.get().getBasicProfile()\n          return Promise.resolve({\n            id: profile.getId(),\n            name: profile.getName(),\n            giveName: profile.getGivenName(),\n            familyName: profile.getFamilyName(),\n            image: profile.getImageUrl(),\n            email: profile.getEmail()\n          })\n        } catch (ers) {\n          return Promise.reject('[getUserProfile] - Error when get user profile')\n        }\n      }\n    }\n  }).bind(this)()\n\n  // init\n  #init = function () {\n    return new Promise(async (resolve, reject) => {\n      const _this = this\n\n      const isHttps: boolean = await (async function () {\n        if (window.location.protocol !== 'https:') {\n          window.location.href = `https:${window.location.href.substring(window.location.protocol.length)}`\n          return false\n        }\n        return true\n      }())\n      if (!isHttps) { reject('Not https') }\n\n      const loadGapi: boolean = await (\n        (url: string) => new Promise((loadGapiResolve, loadGapiReject) => {\n          const script = document.createElement('script')\n          script.type = 'text/javascript'\n          try {\n            script.onload = function (e) {\n              if (window.gapi !== undefined) {\n                loadGapiResolve(true)\n              } else {\n                loadGapiReject(false)\n              }\n            }\n            script.onerror = () => { loadGapiReject(false) }\n            script.src = url\n            document.getElementsByTagName('head')[0].appendChild(script)\n          } catch (ers: any) {\n            loadGapiReject(false)\n          }\n        }))(FryanGoauth['#GAPI'])\n        .then(() => {\n          FryanGoauth['#LIFECYCLE'].afterGapiMounted(window.gapi)\n          this.gapi = window.gapi\n          return true\n        })\n        .catch(() => false)\n      if (!loadGapi) { reject('Gapi is not loaded') }\n\n      const loadGapiClient: any = await (async function () {\n        const { gapi } = _this\n        const task = await new Promise((sResolve, sReject) => {\n          gapi.load('client', () => {\n            if (\n              gapi\n              && gapi.client\n            ) {\n              sResolve(true)\n            } else {\n              sReject(false)\n            }\n          })\n        })\n          .then(() => {\n            FryanGoauth['#LIFECYCLE'].afterGapiClientMounted(_this.gapi.client)\n            return true\n          })\n          .catch(() => false)\n        return task\n      }())\n      if (!loadGapiClient) { reject('Error when loading client from gapi ') }\n\n      const loadGoAuth: any = await (\n        async () => {\n          const task = await new Promise((goAuthResolve, goAuthReject) => {\n            const gClient = this.gapi.client\n            const GOAUTH_CONFIG = FryanGoauth['#GOAUTH_CONFIG']\n\n            gClient.init({\n              apiKey: GOAUTH_CONFIG.apiKey,\n              clientId: GOAUTH_CONFIG.clientID,\n              scope: GOAUTH_CONFIG.scopes.join(' '),\n              discoveryDocs: GOAUTH_CONFIG.discoveryDocs\n            })\n              .then(() => {\n                const { auth2 } = _this.gapi\n\n                const checkSignInOut = function (isSignedIn: boolean) {\n                  if (isSignedIn) {\n                    // signin\n                    const profile = auth2.getAuthInstance().currentUser.get()\n                    const getProfile = profile.getBasicProfile()\n                    const gmail = getProfile.getEmail()\n                    const guid = getProfile.getId()\n                    FryanGoauth['#LIFECYCLE'].oAuthSignedIn({\n                      guid, gmail\n                    })\n                  } else {\n                    // signout\n                    FryanGoauth['#LIFECYCLE'].oAuthSignedOut()\n                  }\n                  FryanGoauth['#LIFECYCLE'].afterOAuthSigned(isSignedIn)\n                }\n\n                // listen Signin\n                auth2.getAuthInstance().isSignedIn.listen(\n                  (isSignedIn: boolean) => {\n                    checkSignInOut(isSignedIn)\n                  }\n                )\n\n                Promise.resolve(\n                  auth2.getAuthInstance()\n                ).then(() => {\n                  const signInStatus = auth2.getAuthInstance().isSignedIn.get()\n                  checkSignInOut(signInStatus)\n                  if (!signInStatus) {\n                    auth2.getAuthInstance().signIn()\n                  }\n                  goAuthResolve(true)\n                })\n              })\n              .catch((ers : any) => {\n                goAuthReject(`An error occurred when loading gapi.client.oAuth`)\n              })\n          })\n          return task\n        }\n      )()\n      if (!loadGoAuth) { reject('Error when loading gapi.client.auth') }\n      resolve(true)\n    })\n  }\n}\n\n// window.FryanGoauth = FryanGoauth\nexport default FryanGoauth\n","import FryanGoauth from './lib'\n\nwindow.FryanGoauth = FryanGoauth\nexport default FryanGoauth\n"],"sourceRoot":""}