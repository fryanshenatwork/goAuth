{"version":3,"sources":["webpack://FryanGoauth/webpack/universalModuleDefinition","webpack://FryanGoauth/webpack/bootstrap","webpack://FryanGoauth/webpack/runtime/define property getters","webpack://FryanGoauth/webpack/runtime/hasOwnProperty shorthand","webpack://FryanGoauth/webpack/runtime/make namespace object","webpack://FryanGoauth/./src/lib/index.ts","webpack://FryanGoauth/./src/main.js"],"names":["root","factory","exports","module","define","amd","self","__webpack_require__","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","FryanGoauth","config","gapi","undefined","then","fn","success","this","catch","error","afterGapiMounted","afterGapiClientMounted","oAuthSignedIn","oAuthSignedOut","afterOAuthSigned","auth","_this","signed","auth2","getAuthInstance","isSignedIn","ers","console","log","Promise","reject","r","signIn","resolve","signOut","profile","currentUser","getBasicProfile","id","getId","name","getName","giveName","getGivenName","familyName","getFamilyName","image","getImageUrl","email","getEmail","bind","window","location","protocol","href","substring","length","url","loadGapiResolve","loadGapiReject","script","document","createElement","type","onload","e","onerror","src","getElementsByTagName","appendChild","sResolve","sReject","load","client","goAuthResolve","goAuthReject","gClient","GOAUTH_CONFIG","init","apiKey","clientId","clientID","scope","scopes","join","discoveryDocs","checkSignInOut","getProfile","gmail","guid","listen","signInStatus","gapiPath","oAuthConfig","err","gapiClient","opt","signedIn"],"mappings":"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","file":"fryan.goauth.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\t//Test Comment\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\t//Test Comment\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\t//Test Comment\n\telse if(typeof exports === 'object')\n\t\texports[\"FryanGoauth\"] = factory();\n\t//Test Comment\n\telse\n\t\troot[\"FryanGoauth\"] = factory();\n})(self, function() {\nreturn ","// The require scope\nvar __webpack_require__ = {};\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","declare global {\n  // eslint-disable-next-line\n  interface Window {\n    gapi: any\n  }\n}\n\ninterface FryanGoAuthInterface {\n\n}\n\ninterface configOauthI {\n  apiKey: String,\n  clientID: String,\n  discoveryDocs: Array<String>\n  scopes: Array<String>\n}\n\ninterface configI {\n  gapiPath: String,\n  oAuthConfig: configOauthI,\n  lifeCycle: {\n  }\n}\n\nclass FryanGoauth implements FryanGoAuthInterface {\n  static '#GAPI': string\n\n  static '#AUTH_OPTIONS': configOauthI\n\n  static '#LIFECYCLE' = {\n    afterGapiMounted: (gapi?: object) => {},\n    afterGapiClientMounted: (gapiClient?: object) => {},\n    oAuthSignedIn: (opt: { guid: string, gmail: string }) => {},\n    oAuthSignedOut: () => {},\n    afterOAuthSigned: (signedIn: boolean) => {},\n    success: () => {},\n    error: (err: string) => {}\n  }\n\n  static '#GOAUTH_CONFIG' : configOauthI = {\n    apiKey: ``,\n    clientID: ``,\n    discoveryDocs: [],\n    scopes: []\n  }\n\n  gapi: any = undefined\n\n  constructor (config: configI) {\n    FryanGoauth['#GAPI'] = `${config.gapiPath}`\n    FryanGoauth['#GOAUTH_CONFIG'].apiKey = config.oAuthConfig.apiKey\n    FryanGoauth['#GOAUTH_CONFIG'].clientID = config.oAuthConfig.clientID\n    FryanGoauth['#GOAUTH_CONFIG'].discoveryDocs = config.oAuthConfig.discoveryDocs\n    FryanGoauth['#GOAUTH_CONFIG'].scopes = config.oAuthConfig.scopes\n    this.#init()\n      .then(() => {\n        FryanGoauth['#LIFECYCLE'].success()\n      })\n      .catch((err) => {\n        FryanGoauth['#LIFECYCLE'].error(err)\n      })\n  }\n\n  // HOOKS\n  then = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].success = fn\n    return this\n  }\n\n  catch = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].error = fn\n    return this\n  }\n\n  afterGapiMounted = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterGapiMounted = fn\n    return this\n  }\n\n  afterGapiClientMounted = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterGapiClientMounted = fn\n    return this\n  }\n\n  oAuthSignedIn = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].oAuthSignedIn = fn\n    return this\n  }\n\n  oAuthSignedOut = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].oAuthSignedOut = fn\n    return this\n  }\n\n  afterOAuthSigned = (fn: () => {}) => {\n    FryanGoauth['#LIFECYCLE'].afterOAuthSigned = fn\n    return this\n  }\n\n  // methods\n  auth = (function () {\n    const _this = this\n\n    return {\n      get isSignedIn () {\n        const { gapi } = _this\n        let signed = false\n        try {\n          signed = gapi.auth2.getAuthInstance().isSignedIn.get()\n        } catch (ers) {\n          console.log('[isSignedIn] - Unready init') // eslint-disable-line\n        }\n        return signed\n      },\n      signin () : Promise<any> {\n        const { gapi } = _this\n\n        if (this.isSignedIn) {\n          return Promise.reject('Already signed in')\n        }\n        try {\n          const r = gapi.auth2.getAuthInstance().signIn()\n          return Promise.resolve(r)\n        } catch (ers) {\n          // console.log('[signin] - Unready init', ers)\n          return Promise.reject(ers)\n        }\n      },\n      signout () : Promise<any> {\n        const { gapi } = _this\n\n        if (!this.isSignedIn) {\n          return Promise.reject('Already signed out')\n        }\n        try {\n          const r = gapi.auth2.getAuthInstance().signOut()\n          return Promise.resolve(r)\n        } catch (ers) {\n          // console.log('[signOut] - Unready init', ers)\n          return Promise.reject(ers)\n        }\n      },\n      get getUserProfile () : Promise<any> {\n        const { gapi } = _this\n\n        if (!this.isSignedIn) {\n          return Promise.reject(false)\n        }\n        try {\n          const profile = gapi.auth2.getAuthInstance()\n            .currentUser.get().getBasicProfile()\n          return Promise.resolve({\n            id: profile.getId(),\n            name: profile.getName(),\n            giveName: profile.getGivenName(),\n            familyName: profile.getFamilyName(),\n            image: profile.getImageUrl(),\n            email: profile.getEmail()\n          })\n        } catch (ers) {\n          return Promise.reject('[getUserProfile] - Error when get user profile')\n        }\n      }\n    }\n  }).bind(this)()\n\n  // init\n  #init = function () {\n    return new Promise(async (resolve, reject) => {\n      const _this = this\n\n      const isHttps: boolean = await (async function () {\n        if (window.location.protocol !== 'https:') {\n          window.location.href = `https:${window.location.href.substring(window.location.protocol.length)}`\n          return false\n        }\n        return true\n      }())\n      if (!isHttps) { reject('Not https') }\n\n      const loadGapi: boolean = await (\n        (url: string) => new Promise((loadGapiResolve, loadGapiReject) => {\n          const script = document.createElement('script')\n          script.type = 'text/javascript'\n          try {\n            script.onload = function (e) {\n              if (window.gapi !== undefined) {\n                loadGapiResolve(true)\n              } else {\n                loadGapiReject(false)\n              }\n            }\n            script.onerror = () => { loadGapiReject(false) }\n            script.src = url\n            document.getElementsByTagName('head')[0].appendChild(script)\n          } catch (ers: any) {\n            loadGapiReject(false)\n          }\n        }))(FryanGoauth['#GAPI'])\n        .then(() => {\n          FryanGoauth['#LIFECYCLE'].afterGapiMounted(window.gapi)\n          this.gapi = window.gapi\n          return true\n        })\n        .catch(() => false)\n      if (!loadGapi) { reject('Gapi is not loaded') }\n\n      const loadGapiClient: any = await (async function () {\n        const { gapi } = _this\n        const task = await new Promise((sResolve, sReject) => {\n          gapi.load('client', () => {\n            if (\n              gapi\n              && gapi.client\n            ) {\n              sResolve(true)\n            } else {\n              sReject(false)\n            }\n          })\n        })\n          .then(() => {\n            FryanGoauth['#LIFECYCLE'].afterGapiClientMounted(_this.gapi.client)\n            return true\n          })\n          .catch(() => false)\n        return task\n      }())\n      if (!loadGapiClient) { reject('Error when loading client from gapi ') }\n\n      const loadGoAuth: any = await (\n        async () => {\n          const task = await new Promise((goAuthResolve, goAuthReject) => {\n            const gClient = this.gapi.client\n            const GOAUTH_CONFIG = FryanGoauth['#GOAUTH_CONFIG']\n\n            gClient.init({\n              apiKey: GOAUTH_CONFIG.apiKey,\n              clientId: GOAUTH_CONFIG.clientID,\n              scope: GOAUTH_CONFIG.scopes.join(' '),\n              discoveryDocs: GOAUTH_CONFIG.discoveryDocs\n            })\n              .then(() => {\n                const { auth2 } = _this.gapi\n\n                const checkSignInOut = function (isSignedIn: boolean) {\n                  if (isSignedIn) {\n                    // signin\n                    const profile = auth2.getAuthInstance().currentUser.get()\n                    const getProfile = profile.getBasicProfile()\n                    const gmail = getProfile.getEmail()\n                    const guid = getProfile.getId()\n                    FryanGoauth['#LIFECYCLE'].oAuthSignedIn({\n                      guid, gmail\n                    })\n                  } else {\n                    // signout\n                    FryanGoauth['#LIFECYCLE'].oAuthSignedOut()\n                  }\n                  FryanGoauth['#LIFECYCLE'].afterOAuthSigned(isSignedIn)\n                }\n\n                // listen Signin\n                auth2.getAuthInstance().isSignedIn.listen(\n                  (isSignedIn: boolean) => {\n                    checkSignInOut(isSignedIn)\n                  }\n                )\n\n                Promise.resolve(\n                  auth2.getAuthInstance()\n                ).then(() => {\n                  const signInStatus = auth2.getAuthInstance().isSignedIn.get()\n                  checkSignInOut(signInStatus)\n                  if (!signInStatus) {\n                    auth2.getAuthInstance().signIn()\n                  }\n                  goAuthResolve(true)\n                })\n              })\n              .catch((ers : any) => {\n                goAuthReject(`An error occurred when loading gapi.client.oAuth`)\n              })\n          })\n          return task\n        }\n      )()\n      if (!loadGoAuth) { reject('Error when loading gapi.client.auth') }\n      resolve(true)\n    })\n  }\n}\n\n// window.FryanGoauth = FryanGoauth\nexport default FryanGoauth\n","import FryanGoauth from './lib'\n\nexport default FryanGoauth\nexport { FryanGoauth }\n"],"sourceRoot":""}